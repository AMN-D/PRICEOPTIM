{% extends 'base.html' %}
{% load static %}
{% block start %}
<div class="body-your-main">
    <div class="body-your-main-scroll">
        <div class="scroll1"><a href="###">.</a></div>
        <div class="scroll2"><a href="####">.</a></div>
        <div class="scroll3"><a href="#####">.</a></div>
    </div>
    <div class="body-your-inside">
        <div class="body-your-inside-text-container">
                <div class="body-your-inside-text">
                    <h1>PICK</h1>
                    <h1>MODEL</h1>
                </div>
                <div class="body-your-inside-desc">
                    <p>WORKING ?</p>
                </div>
                <div class="body-your-inside-desc-detail">
                    <p>Select your model, peek at the CSV preview, pick optimization features, input product details, and watch your optimization results unfold!</p>
                </div>
                <div class="body-your-inside-model-selector">
                    <select id="selectOption">
                        <option value="0">---</option>
                        <option value="1">LOWKEY</option>
                    </select>
                </div>
                <div class="body-your-inside-design">
                    <p>091</p>
                </div>
            </div>
            <div class="body-your-inside-csv-container">
                <p>CSV</p>
            </div>
        </div>
    </div>
    <div class="body-your-feature">
        <div class="body-your-feature-inside">
            <div class="body-your-feature-input">
                <div class="body-your-feature-input-text">
                    <h1>Finding the<br> 
                        Ideal Price for Your <br>
                        Product</h1>
                </div>
                <div class="body-your-feature-input-paragraph">
                    <p>DPO for Business: Precision Pricing Made Simple. Discover the Ideal Price for Your Product or Service, Regardless of Your Business. Maximize Profitability with Confidence</p>
                </div>
                <div class="body-your-feature-input-main-eval">
                    <button class="custom-button" onclick="retrieveInputFieldValuesAndSendData()">Evaluate</button>

                </div>
                <div class="body-your-inside-design-input-main">
                    <p>092</p>
                </div>
            </div>
            <div class="body-your-feature-selector">
                <div class="body-your-feature-selector-inside">
                    <div class="body-your-feature-selector-inside-text">
                        <h1>the CostOptim<br>
                            project
                        </h1>
                    </div>
                    <div class="body-your-feature-selector-inside-inside">
                        <div class="body-your-feature-checkbox" id="feature-checkbox-div"></div>
                        <div class="body-your-feature-input-main" id="feature-input-container"></div>
                    </div>
                    <div class="body-your-feature-inside-desc">
                        <p>Rest assured, your data remains transient and never leaves your device. Your privacy is paramount in our approach.<br>
                        For optimal results, ensure precision in your input. Accurate data fuels our project's efficacy and unlocks its full potential.<br>
                        Unlock the power of numerical inputs! Our system exclusively accepts numerical data, easily derived from the provided CSV.</p>
                    </div>
                    <div class="outcome-div-cover-bottom">
                        <div class="outcome-div-cover">
                            <div class="body-your-feature-outcome-desc">
                                <p>We are going to predict this value</p>
                            </div>
                            <div class="body-your-feature-outcome" id="outcome-div"></div>
                        </div>
                        <div>
                            <h1 class="logo-inside">DNN</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="body-result">
        <div class="body-result-inside">
            <div class="body-result-header">
                <div class="body-result-header-logo">~</div>
                <div class="body-result-header-desc">
                    <p>RESULT</p>
                </div>
            </div>
            <div class="body-result-container">
                <div class="body-result-container-main">
                    <div class="model-name">
                        <h1 id="modelName">MODEL- </h1>
                    </div>
                    <div class="other-values-old">
                        <h1 id="oldValue">VALUEOLD- </h1>
                    </div>
                    <div class="other-values-new">
                        <h1 id="newValue">VALUENEW- </h1>
                    </div>
                    <div class="other-values-rmse">
                        <h1 id="rmse">RMSE- </h1>
                    </div>
                    <div class="other-values-mse">
                        <h1 id="mse">MSE- </h1>
                    </div>
                    <div class="other-values-msc">
                        <h1 id="mae">MAE- </h1>
                    </div>
                    <div class="body-result-container-main-desc">
                        <p>2024<br>
                            <a href="https://github.com/AMN-D" target="_blank">@AMN-D</a>
                        </p>                        
                    </div>
                </div>
                <div class="body-result-container-info">
                    <div class="body-result-container-info-text">
                        <h6>THANKS FOR VISITING</h6>
                        <p>price optimization</p>
                        <p>using DNN.</p>
                    </div>
                    <div class="body-result-container-info-text-bottom">
                        <p><a href="https://mail.google.com/mail/?view=cm&to=amanddhumal@gmail.com" target="_blank">amanddhumal@gmail.com</a></p>
                        <p><a href="https://www.linkedin.com/in/aman-dhumal-20b882297/?originalSubdomain=in" target="_blank">LINKEDIN</a></p>                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    
    window.addEventListener('scroll', function() {
        var scrollPosition = window.scrollY;
        var scroll1 = document.querySelector('.scroll1');
        var scroll2 = document.querySelector('.scroll2');
        var scroll3 = document.querySelector('.scroll3');

        // Increase the height of the first dot if at the top
        if (scrollPosition <= 200) {
            scroll1.classList.add('increase');
        } else {
            scroll1.classList.remove('increase');
        }

        // Increase the height of the second dot if below the top and within a certain range
        if (scrollPosition > 200 && scrollPosition <= 800) {
            scroll2.classList.add('increase');
        } else {
            scroll2.classList.remove('increase');
        }

        // Increase the height of the third dot if below the second dot
        if (scrollPosition > 900) {
            scroll3.classList.add('increase');
        } else {
            scroll3.classList.remove('increase');
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
        const scroll1 = document.querySelector('.scroll1');
        const scroll2 = document.querySelector('.scroll2');
        const scroll3 = document.querySelector('.scroll3');

        scroll1.addEventListener("click", function(event) {
            event.preventDefault();
            scrollToSection(".body-your-inside");
        });

        scroll2.addEventListener("click", function(event) {
            event.preventDefault();
            scrollToSection(".body-your-feature");
        });

        scroll3.addEventListener("click", function(event) {
            event.preventDefault();
            scrollToSection(".body-result-inside");
        });
    });

    function scrollToSection(sectionSelector) {
        const targetDiv = document.querySelector(sectionSelector);
        const targetPosition = getOffset(targetDiv);
        window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
        });
    }

    function getOffset(element) {
        let offset = 0;
        while (element) {
            offset += element.offsetTop;
            element = element.offsetParent;
        }
        return offset;
    }

    document.addEventListener("DOMContentLoaded", function() {
        const sampleLink = document.querySelector('a[href="####"]');
        const offset = 730;

        sampleLink.addEventListener("click", function(event) {
            event.preventDefault(); // Prevent the default link behavior
            const targetPosition = this.parentElement.offsetTop + offset;
            window.scrollTo({
                top: targetPosition,
                behavior: "smooth"
            });
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const sampleLink = document.querySelector('a[href="###"]');
        const offset = 0;

        sampleLink.addEventListener("click", function(event) {
            event.preventDefault(); // Prevent the default link behavior
            const targetPosition = this.parentElement.offsetTop + offset;
            window.scrollTo({
                top: targetPosition,
                behavior: "smooth"
            });
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const sampleLink = document.querySelector('a[href="#####"]');
        const offset = 1450;

        sampleLink.addEventListener("click", function(event) {
            event.preventDefault(); // Prevent the default link behavior
            const targetPosition = this.parentElement.offsetTop + offset;
            window.scrollTo({
                top: targetPosition,
                behavior: "smooth"
            });
        });
    });

</script>

<script>
    document.getElementById('selectOption').addEventListener('change', function() {
        var modelName = document.getElementById('modelName');
        var rmseElement = document.getElementById('rmse');
        var mseElement = document.getElementById('mse');
        var maeElement = document.getElementById('mae');
        var oldValueElement = document.getElementById('oldValue');
        var newValueElement = document.getElementById('newValue');
        var selectOption = document.getElementById('selectOption');
        var selectedValue = selectOption.value;
        var selectedText = selectOption.options[selectOption.selectedIndex].text;
        modelName.textContent = "MODEL- " + selectedText;

        if (selectedValue === "1") {
            var rmse = parseFloat("{{ rmse }}").toFixed(6); 
            rmseElement.textContent = "RMSE- " + rmse;
            var mse = parseFloat("{{ mse }}").toFixed(3); 
            mseElement.textContent = "MSE- " + mse;
            var mae = parseFloat("{{ mae }}").toFixed(2); 
            maeElement.textContent = "MAE- " + mae;
        } else {
            rmseElement.textContent = "RMSE- ";
            mseElement.textContent = "MSE- ";
            maeElement.textContent = "MAE- ";
            oldValueElement.textContent = "VALUEOLD- ";
            newValueElement.textContent = "VALUENEW- ";
        }
    });
</script>

<script>

    function sendDataToDjango(inputData) {
        fetch('/custom/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(inputData)
        })
        .then(response => {
            if (response.ok) {
                return response.json(); // Parse the JSON response
            } else {
                throw new Error('Failed to fetch data');
            }
        })
        .then(data => {
            // Update HTML content with optimized_price
            const optimizedPriceElement = document.getElementById('newValue');
            if (optimizedPriceElement) {
                const optimizedPrice = parseFloat(data.optimized_price).toFixed(7);
                optimizedPriceElement.innerText = 'VALUENEW - ' + optimizedPrice;
            } else {
                console.error('Element with id "newValue" not found');
            }
            
            // Update HTML content with historical_price_scaled
            const historicalPriceElement = document.getElementById('oldValue');
            if (historicalPriceElement) {
                historicalPriceElement.innerText = 'VALUEOLD - ' + data.historical_price_scaled;
            } else {
                console.error('Element with id "oldValue" not found');
            }
        })
        .catch(error => {
            console.error('Error sending data to Django:', error);
        });
    }

    function retrieveInputFieldValuesAndSendData() {
        var inputFields = document.querySelectorAll('input[type="number"]');
        var inputData = {};

        inputFields.forEach(function(input, index) {
            var inputName = input.getAttribute('name');
            inputData[inputName] = input.value;
        });

        sendDataToDjango(inputData);
    }

    document.addEventListener("DOMContentLoaded", function () {
        var selectElement = document.getElementById('selectOption');
        var outcomeDiv = document.getElementById('outcome-div');
        var featureCheckboxDiv = document.getElementById('feature-checkbox-div');
        var inputContainerDiv = document.getElementById('feature-input-container');
        var containerDiv = document.querySelector('.body-your-inside-csv-container');
        var features = {{ features|safe }};
        var selectedFeatures = [];

        function generateInputFields(selectedFeatures) {
            inputContainerDiv.innerHTML = '';

            selectedFeatures.forEach(function(feature, index) {
                var input = document.createElement('input');
                var inputId = 'input_' + index; 
                var inputName = feature; 
                input.id = inputId;
                input.name = inputName; 
                input.type = 'number';
                input.placeholder = inputName.toUpperCase(); 
                input.required = true; 
                input.classList.add('custom-input');

                input.setAttribute('inputMode', 'numeric');

                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9.]/g, '');
                });

                inputContainerDiv.appendChild(input);
            });
        }

        function removeInputFields(featureToRemove) {
            var inputFieldsToRemove = document.querySelectorAll('input[name="' + featureToRemove + '"]');
            inputFieldsToRemove.forEach(function(inputField) {
                inputField.parentNode.removeChild(inputField);
            });
        }

        function createFeatureCheckbox(feature) {
            var checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = feature;
            checkbox.id = feature;

            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    selectedFeatures.push(this.value);
                } else {

                function createFeatureCheckbox(feature) {
                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = feature;
                    checkbox.id = feature;

                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            selectedFeatures.push(this.value);
                        } else {
                            selectedFeatures = selectedFeatures.filter(function(item) {
                                return item !== this.value;
                            }.bind(this)); 
                            removeInputFields(this.value);
                        }
                        generateInputFields(selectedFeatures);
                    });

                    var label = document.createElement('label');
                    label.htmlFor = feature;
                    label.appendChild(document.createTextNode(feature));

                    featureCheckboxDiv.appendChild(checkbox);
                    featureCheckboxDiv.appendChild(label);
                    featureCheckboxDiv.appendChild(document.createElement('br'));
                }
                        selectedFeatures = selectedFeatures.filter(function(item) {
                            return item !== this.value;
                        }.bind(this)); 
                        removeInputFields(this.value);
                    }
                generateInputFields(selectedFeatures);
            });

            var label = document.createElement('label');
            label.htmlFor = feature;
            label.appendChild(document.createTextNode(feature));
            featureCheckboxDiv.appendChild(checkbox);
            featureCheckboxDiv.appendChild(label);
            featureCheckboxDiv.appendChild(document.createElement('br'));
        }

        selectElement.addEventListener('change', function () {
            if (selectElement.value === '1') {
                var outcome = "{{ outcome }}";
                outcomeDiv.innerHTML = outcome;
                featureCheckboxDiv.innerHTML = '';
                features.forEach(function(feature) {
                    createFeatureCheckbox(feature);
                });
                var jsonData = JSON.parse('{{ json_data|escapejs }}');
                var table = '<table border="1">';
                table += '<tr>';
                for (var key in jsonData[0]) {
                    table += '<th>' + key + '</th>';
                }
                table += '</tr>';
                for (var i = 0; i < jsonData.length; i++) {
                    table += '<tr>';
                    for (var key in jsonData[i]) {
                        table += '<td>' + jsonData[i][key] + '</td>';
                    }
                    table += '</tr>';
                }
                table += '</table>';
                containerDiv.innerHTML = table;
            } else if (selectElement.value === '0') {
                outcomeDiv.innerHTML = '';
                inputContainerDiv.innerHTML = '';
                featureCheckboxDiv.innerHTML = '';
                containerDiv.innerHTML = '';
            } else {
                console.log('Select a value');
            }
        });
    });

</script>

<script>
document.querySelector('.custom-button').addEventListener('click', function() {
    // Check if there are any input fields
    var inputFields = document.querySelectorAll('#feature-input-container input');
    if (inputFields.length === 0) {
        alert("Please select a feature to proceed.");
        return;
    }

    // Check if all input fields are filled
    var allFilled = true;
    inputFields.forEach(function(input) {
        if (!input.value.trim()) {
            allFilled = false;
            return; // Exit loop early if any input is empty
        }
    });

    if (allFilled) {
        // Your existing code for animations here

        // Scroll down to the third div (`.body-result-inside`)
        scrollToSection(".body-result-inside");
    } else {
        alert("Please fill in all input fields before proceeding.");
    }
});

document.getElementById('selectOption').addEventListener('change', function () {
    // Get the value of the select element
    var selectValue = this.value;

    if (selectValue === '0') {
        // Revert changes
        const line = document.querySelector('.line');
        line.style.animation = ''; // Reset animation

        const canvas = document.querySelector('.small-canvas');
        canvas.style.width = ''; 
        canvas.style.animation = ''; // Reset animation
        canvas.style.backgroundColor = ''; 

        // Reset button color
        const button = document.querySelector('.custom-button');
        button.style.backgroundColor = ''; 
    }
});

function scrollToSection(sectionSelector) {
    const targetDiv = document.querySelector(sectionSelector);
    const targetPosition = getOffset(targetDiv);
    window.scrollTo({
        top: targetPosition,
        behavior: "smooth"
    });
}

function getOffset(element) {
    let offset = 0;
    while (element) {
        offset += element.offsetTop;
        element = element.offsetParent;
    }
    return offset;
}

</script>

{% endblock %}

{% block footer %}
<footer>
    <div class="foot-main">
        <div class="foot-main-text">
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
                Liked what you saw?
            </h1>
            <p>Help us grow by starring our project on 
                <a href="https://github.com/AMN-D/ecommerce_price_optimisation" target="_blank">GitHub!</a>
            </p>
        </div>
        <div class="foot-main-icons">
            <a href="https://www.youtube.com/channel/UCwc9Yk0LJnRya5u-iPQrNwA" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="#121212" d="m10 15l5.19-3L10 9zm11.56-7.83c.13.47.22 1.1.28 1.9c.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44c.9.25 1.48.83 1.73 1.73"/></svg>
            </a>
            <a href="https://github.com/AMN-D" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M12 2a10 10 0 00-3.16 19.49c.5.09.68-.22.68-.48v-1.68c-2.78.6-3.37-1.34-3.37-1.34-.45-1.15-1.1-1.46-1.1-1.46-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.5 2.37 1.07 2.95.82.1-.65.35-1.08.64-1.33-2.24-.25-4.6-1.12-4.6-4.99 0-1.1.39-2 1.03-2.7-.1-.25-.45-1.28.1-2.66 0 0 .85-.27 2.78 1.03.81-.22 1.68-.33 2.54-.33s1.73.11 2.54.33c1.93-1.3 2.78-1.03 2.78-1.03.56 1.38.21 2.41.1 2.66.64.69 1.03 1.6 1.03 2.7 0 3.88-2.36 4.74-4.6 4.99.36.31.68.93.68 1.87v2.78c0 .26.18.57.69.47A10 10 0 0012 2z" clip-rule="evenodd"/>
                </svg>
            </a>
            <a href="https://www.linkedin.com/in/aman-dhumal-20b882297/?originalSubdomain=in" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"/></svg>
            </a>
            <a href="https://mail.google.com/mail/?view=cm&to=amanddhumal@gmail.com" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="#121212" d="M20 18h-2V9.25L12 13L6 9.25V18H4V6h1.2l6.8 4.25L18.8 6H20m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
            </a>
        </div>
    </div>
</footer>
{% endblock %}
