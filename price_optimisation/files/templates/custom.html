{% extends 'base.html' %}
{% load static %}
{% block start %}
<div class="body-your-main">
    <div class="body-your-main-scroll"></div>
    <div class="body-your-inside">
        <div class="body-your-inside-text-container">
                <div class="body-your-inside-text">
                    <h1>PICK</h1>
                    <h1>MODEL</h1>
                </div>
                <div class="body-your-inside-desc">
                    <p>WORKING ?</p>
                </div>
                <div class="body-your-inside-desc-detail">
                    <p>Select your model, peek at the CSV preview, pick optimization features, input product details, and watch your optimization results unfold!</p>
                </div>
                <div class="body-your-inside-model-selector">
                    <select id="selectOption">
                        <option value="0">---</option>
                        <option value="1">LOWKEY</option>
                    </select>
                </div>
                <div class="body-your-inside-design">
                    <p>091</p>
                </div>
            </div>
            <div class="body-your-inside-csv-container">
                <table id="csv-table"></table>
                <p>CSV</p>
            </div>
        </div>
    </div>
    <div class="body-your-feature">
        <div class="body-your-feature-inside">
            <div class="body-your-feature-input">
                <div class="body-your-feature-input-main" id="feature-input-container"></div>
                <div class="body-your-feature-input-main-eval">
                    <button class="custom-button">Evaluate</button>
                </div>
                <div class="body-your-feature-design">
                    <h1>YOU</h1>
                </div>
            </div>
            <div class="body-your-feature-selector">
                <div class="body-your-feature-checkbox"></div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var selectElement = document.getElementById('selectOption');
        var containerDiv = document.querySelector('.body-your-inside-csv-container');
        var inputContainerDiv = document.querySelector('.body-your-feature-input-main');
        var paragraph = document.createElement('p'); 
        var featureCheckboxDiv = document.querySelector('.body-your-feature-checkbox');
        var features = {{ features|safe }};
        var selectedFeatures = []; // Array to store selected features

        function generateInputFields(selectedFeatures) {
            var container = document.getElementById('feature-input-container');
            // Clear the input container
            container.innerHTML = '';

            selectedFeatures.forEach(function(feature) {
                var input = document.createElement('input');
                input.type = 'text';
                input.placeholder = feature.toUpperCase().replace('_', ' '); // Assuming features are in snake_case

                container.appendChild(input);
            });
        }

        // Function to create checkbox for each feature
        function createFeatureCheckbox(feature) {
            var checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = feature;
            checkbox.id = feature;
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    selectedFeatures.push(feature); // Push the feature, not this.value
                } else {
                    selectedFeatures = selectedFeatures.filter(function(item) {
                        return item !== feature; // Remove the feature, not this.value
                    });
                    removeInputFields(feature);
                }
                generateInputFields(selectedFeatures);
            });
            
            var label = document.createElement('label');
            label.htmlFor = feature;
            label.appendChild(document.createTextNode(feature));
            
            featureCheckboxDiv.appendChild(checkbox);
            featureCheckboxDiv.appendChild(label);
            featureCheckboxDiv.appendChild(document.createElement('br'));
        }

        // Function to remove input fields for unchecked features
        function removeInputFields(feature) {
            var container = document.getElementById('feature-input-container');
            var inputs = container.querySelectorAll('input');
            inputs.forEach(function(input) {
                if (input.placeholder.toLowerCase().includes(feature.toLowerCase())) {
                    input.remove();
                }
            });
        }

        selectElement.addEventListener('change', function () {
            if (selectElement.value === '1') {
                // Clear the input container
                inputContainerDiv.innerHTML = '';
                // Generate input fields
                generateInputFields(selectedFeatures);

                if (containerDiv) {
                    var jsonData = JSON.parse('{{ json_data|escapejs }}');
                    var table = '<table border="1">';
                    table += '<tr>';
                    for (var key in jsonData[0]) {
                        table += '<th>' + key + '</th>';
                    }
                    table += '</tr>';
                    for (var i = 0; i < jsonData.length; i++) {
                        table += '<tr>';
                        for (var key in jsonData[i]) {
                            table += '<td>' + jsonData[i][key] + '</td>';
                        }
                        table += '</tr>';
                    }
                    table += '</table>';
                    containerDiv.innerHTML = table;

                    if (containerDiv.contains(paragraph)) {
                        containerDiv.removeChild(paragraph);
                    }
                }

                // Clear the feature checkbox container
                featureCheckboxDiv.innerHTML = '';

                // Create checkboxes for each feature
                features.forEach(function(feature) {
                    createFeatureCheckbox(feature);
                });
            } else if (selectElement.value === '0') {
                // Clear the input container
                inputContainerDiv.innerHTML = '';
                containerDiv.innerHTML = '';
                paragraph.textContent = 'CSV';
                containerDiv.appendChild(paragraph);

                // Clear the feature checkbox container
                featureCheckboxDiv.innerHTML = '';
            } else {
                console.log('Select a value');
            }
        });
    });
</script>

{% endblock %}
{% block footer %}
{% endblock %}
